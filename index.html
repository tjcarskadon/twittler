<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="lib/underscore-min.js"></script>
    <script src="lib/tools.js"></script>
   <link href="css/tweets.css" rel="stylesheet">
   <link href="css/simple-sidebar.css" rel="stylesheet">
  </head>
  <body>
    <div id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <div class="user-card">
          <div class="user-top">
          </div>
          <!-- /user top -->
          <div class="user-content">
            <div class="avatar-container"> 
              <img class="user-avatar" src="img/btc.jpg"></img>
            </div>
            <!-- /avatar-container -->
            <div class="user-info">
              <div class="user-name u-textTruncate">Bill The Cat</div>
              <div class="user-handle">@billthecat</div>
            </div>
            <!-- /user-info -->
           </div>
            <!-- /user-content  -->
        </div>
        <!-- /user-card -->
      </div>
      <!-- /sidebar-wrapper  -->
      <div class="main-content">
        <div class="stream-container">
          <div class="stream-item new-tweets">
            place holder for new tweet loader
          </div>
          <ol class="stream-items">

          </ol>
        </div>
        <!-- /contaier-fluid -->
      </div>
      <!-- /page-content-wrapper -->
    </div>
    <!-- /#wrapper -->
    <script>

      $(document).ready(function(){
        var $body = $('body');
        var displayedTweets = [];
        var userId = [];
        var userFilter = false;
        var tweetUser='';

        //function to print tweets to the window
        function printTweets() { 
          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<li class="stream-item"></li>');
            var tweetTime = time_ago(tweet.created_at);
            userId.push(tweet.user);
            $tweet.html('<span id="user" class= "'+tweet.user+'"><span class=fullname "'+tweet.user+'">'+ tweet.user + '</span> | <span class= handle "'+tweet.user+'"><a href="#">'+ '@' + tweet.user + '</a></span> | <span class=time "'+tweet.user+'">' + tweetTime + '</span><p>' + tweet.message +'</p></span>');
            if(displayedTweets.indexOf(tweet.message) === -1) {
              $tweet.prependTo('.stream-container');
            } else {
              var timeIndex = displayedTweets.indexOf(tweet.created_at);
              var updatedTime = time_ago(displayedTweets[timeIndex]);
              console.log(displayedTweets[timeIndex]);
              $('span').hasClass(tweet.user + ' time');
                $(tweet.user+'.time').text(updatedTime);

            }
            index -= 1;
            displayedTweets.push(tweet.message,tweet.created_at);
          }
          
          //event handler for user filtering.
           $('a').click(function(e){
              userFilter = true;
              tweetUser = $(this).closest("span").attr('class');
              $('span[class!='+tweetUser+']').hide(); 
              $('.time').show(); 
              $('.button').find('.loader').text('Reload All Tweets');
            });
        }
         var $button = $('<button class="loader">Load Tweets</button>');
         $button.appendTo('.user-content');
         //button and handler for displaying new tweets
         $('.button').on('click', '.loader',function(){
           if(!userFilter){
              printTweets();
           } else {
              $(this).text("Load Tweets");
              $('span[class!='+tweetUser+']').show();
              displayedTweets=[];
              printTweets();
           }
         });
      
        //first call to load the tweets.
        printTweets();
      });
    </script>
    
  </body>
</html>
