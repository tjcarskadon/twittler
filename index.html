<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="lib/underscore-min.js"></script>
    <script src="lib/tools.js"></script>
   <link href="css/tweets.css" rel="stylesheet">
   <link href="css/simple-sidebar.css" rel="stylesheet">
  </head>
  <body>
    <div id="wrapper">
      <!-- Sidebar -->
      <div id="sidebar-wrapper">
        <div class="user-card">
          <div class="user-top">
          </div>
          <!-- /user top -->
          <div class="user-content">
            <div class="avatar-container"> 
              <img class="user-avatar" src="img/btc.jpg"></img>
            </div>
            <!-- /avatar-container -->
            <div class="user-info">
              <div class="user-name u-textTruncate">Bill The Cat</div>
              <div class="user-handle">@billthecat</div>
            </div>
            <!-- /user-info -->
            <div class="user-stats"> 
              <ul class="stat-list">
                <li class="stat">
                  <span class="stat-label">Tweets</span>
                  <span class="stat-value">10</span>
                </li>
                 <li class="stat">
                  <span class="stat-label">Following</span>
                  <span class="stat-value">15</span>
                </li>
                 <li class="stat">
                  <span class="stat-label">Followers</span>
                  <span class="stat-value">1000</span>
                </li>
              </ul>
            </div>
            <!-- /user-stats -->
           </div>
            <!-- /user-content  -->
        </div>
        <!-- /user-card -->
      </div>
      <!-- /sidebar-wrapper  -->
      <div class="main-content">
        <div class="stream-container"> 
          <div class="stream-item tweet-loader">
          </div>
          <div class="stream">
            <ol class="stream-items"></ol>
          </div>
          <!-- /stream -->
        </div>
        <!-- /stream-container -->
      </div>
      <!-- /main-content -->
    </div>
    <!-- /#wrapper -->
    <script>

      $(document).ready(function(){
        var $body = $('body');
        var displayedTweets = [];
        var userId = [];
        var userFilter = false;
        var tweetUser='';

        //function to print tweets to the window
        function printTweets() { 
          var index = streams.home.length - 1;
          while(index >= 0){
            var tweet = streams.home[index];
            var $tweet = $('<li class="stream-item ' + tweet.user + '"></li>');
            var tweetTime = time_ago(tweet.created_at);
            userId.push(tweet.user);
            var tweetAvatar = getTweetImage(tweet.user);
            $tweet.html('<div class="content"> <div class="tweet-header">' +tweetAvatar +'<div class="fullname '+tweet.user+'">'+ tweet.user + '</div> <div class= "handle '+tweet.user+'"> | <a href="#" class="uFilter">'+ '@' + tweet.user + '</a></div> <div class="time '+tweet.user+'""> | ' + tweetTime + '</div></div><p class="tweet-text">' + tweet.message +'</p></div>');
            if(displayedTweets.indexOf(tweet.message) === -1) {
              $tweet.prependTo('.stream-items');
            } 
            index -= 1;
            displayedTweets.push(tweet.message,tweet.created_at);
          }
          
          //event handler for user filtering.
           $('.uFilter').click(function(){
              userFilter = true;
              var getUser = $(this).closest("li").attr('class');
              tweetUser = getUser.split(' ').pop();
              $('li[class!= "stream-item '+tweetUser+'"]').remove(); 
              $('.loader').text('Reload All Tweets');
            });
        }

        function getTweetImage (user) {

          switch (user) {
            case "shawndrost":
              return '<img class="tweet-avatar" src="img/steve.jpeg"></img>';
            case "sharksforcheap":
              return '<img class="tweet-avatar" src="img/opus2.jpeg"></img>';
            case "mracus":
              return '<img class="tweet-avatar" src="img/ban2000.jpeg"></img>';
            case "douglascalhoun":
              return '<img class="tweet-avatar" src="img/milo.jpeg"></img>';
          }
        }

        var $loadLink = $('<a href="#" class="loader">Load Tweets</a>');
        $loadLink.appendTo('.tweet-loader');
         $('.loader').click(function(){
           if(!userFilter){
              printTweets();
           } else {
              userFilter = false;
              $(this).text("Load Tweets");
              $('li[class = "stream-item '+tweetUser+'"]').remove();
              displayedTweets=[];
              printTweets();
           }
         });
      
        //first call to load the tweets.
        printTweets();
      });
    </script>
    
  </body>
</html>
